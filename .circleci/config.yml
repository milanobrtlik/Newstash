
defaults: &job-defaults
  docker:
    - image: circleci/php:7.3-fpm-node-browsers-legacy

jobs:
    # ---------> BUILD <---------
    build:
        <<: *job-defaults

        steps:
            - setup_remote_docker:
                docker_layer_caching: true
            - checkout
            - run: 'echo "what up!"'
            - run: |
                sudo apt-get install yarn
            - run: |
                cd Symfony && \
                yarn encore production
            - run: |
                cd Symfony && \
                composer \
                    --classmap-authoritative \
                    --ignore-platform-reqs \
                    --no-scripts \
                    install

# composer install
# yarm install
# build php
# build nginx
# store to workspace


    # ---------> TEST <---------
    test:
        <<: *job-defaults

        steps:
            - setup_remote_docker:
                docker_layer_caching: true
            - checkout

            - run: 'echo "what up!"'





# -----------------------------------------------------------------------------
workflows:
  version: 2




  # ---------------------------------------------------------------------------
  # test only path for random commits
  commit_test:
    jobs:

    - build:
        filters:
          branches:
            only: /.*/
    - test:
        requires:
        - build

